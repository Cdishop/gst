---
output:
  pdf_document: default
  html_document: default
---

# Results

## Simulation World 1 (X causes Y)

In the first simulation world we generated data such that $x$ causes $y$ across lag structures ranging from 0 (i.e., concurrent causation) through 5 (i.e., delayed causation). In other words, the true data generating mechanisms were $x_t {\Rightarrow} y_t$, $x_{(t-1)} {\Rightarrow} y_t$, $x_{(t-2)} {\Rightarrow} y_t$, $x_{(t-3)} {\Rightarrow} y_t$, $x_{(t-4)} {\Rightarrow} y_t$, $x_{(t-5)} {\Rightarrow} y_t$. We then fit the same two models to the data generated in each of these possible worlds. The first model included $x$ and the first lag of the outcome variable, $y_{(t-1)}$ as predictors of $y_t$. The second model used $x$ as the lone predictor of $y_t$.

Figure 1 presents the proportion of significant results for the test of $H0:b_1 = 0$ across the varying true time lags for each of these models (i.e., rows 1 and 2 of Table 1). For the model including $y_{(t-1)}$ as a covariate, the proportion of coefficient estimates that are significant reaches 100% when $x$ is a true concurrent cause of $y$ and falls to the nominal Type I error rate for all other lag structures. A similar pattern occurs for the model that does not use  $y_{(t-1)}$ as a covariate. The proportion of coefficient estimates that are significant again reached 100% when $x$ is a concurrent cause of $y$ and fall to the nominal Type I error rate across the other lag structures.

These results demonstrate two important points. First, when the data generating process coheres exactly with beliefs about *both* the direction and lag structure of causation, HLM appropriately captures the relationship irrespective of whether a lagged outcome variable is included in the model. Second, these models are unable to detect causal relations between $x$ and $y$ when the true lag structure is not reflected in the model. In this case, the directionality belief is accurate, in the sense that $x$ does cause $y$, but it goes undetected because the causal lag structure is not correctly specified in the fitted model.


\begin{center}

---------------

Insert Figure 1 Here

---------------

\end{center}



## Simulation World 2 (Y causes X)

In the second simulation world we generated data in the reverse direction such that $y$ causes $x$ across the six lag conditions (i.e., $y_t {\Rightarrow} x_t$, $y_{(t-1)} {\Rightarrow} x_t$, $y_{(t-2)} {\Rightarrow} x_t$, $y_{(t-3)} {\Rightarrow} x_t$, $y_{(t-4)} {\Rightarrow} x_t$, $y_{(t-5)} {\Rightarrow} x_t$).  We then fit the same two models used above to the resulting data (i.e., rows 3 and 4 of Table 1).

Figure 2 depicts the proportion of significant $b_1$ estimates across the simulation replicates for each of the two fitted models. For the first model including $y_{(t-1)}$ as a covariate, the significance tests on the $b_1$ coefficient substantially exceed the nominal level (100%) under the concurrent-lag structure (i.e., zero-lag). Since the direction of the relationship is misspecified in this model, these results represent Type I errors. Over increasingly longer lags the rejection rates fall to 9.8% under the lag-one structure, 7.2% under the lag-three structure, and near the nominal level at other lag-structures. Moving to the second model, which did not include prior $y$ as a covariate, the proportion of significant coefficients also reached 100% under the concurrent causal structure and exhibits comparable behavior to the other model under longer lags. 

When the data generating process and our beliefs about the direction and lag structure of effects are incoherent, therefore, directionality inferences are substantially inaccurate. Type I error rates are 100% for the concurrent lag structure and fluctuate around the nominal level under longer lags.


\begin{center}

---------------

Insert Figure 2 Here

---------------

\end{center}


## Simulation World 3 (Z causes X and Y)

In this simulation world, a third variable ($z$) causes both $x$ and $y$ meaning that $x$ and $y$ are not causally linked and no meaningful inference of directionality can be supported by the observed relationship between $x$ and $y$. We examine the performance of the fitted HLM models under three patterns of true lagged causal structure. In the first case, the lag effect from $z$ is symmetric for both $x$ and $y$. That is, if $z_{t-2}$ causes $x_{t}$ then $z_{t-2}$ causes $y_{t}$. In the second and third cases the lag effect of $z$ on $x$ and $y$ is asymmetric.

We first consider results when the lag effect from $z$ is symmetric for both $x$ and $y$. Figure 3 shows the proportion of significant $b_1$ estimates under the model that includes prior $y$ as a covariate. Across all lag structures significance tests substantially exceed the nominal level (ranging from 9.6% to 13.0%). When prior $y$ is not included as a covariate (figure 4) the results are nearly identical; the proportion of significant estimates are 13.6%, 12.6%, 9.4%, 11.4%, and 12.4% across the respective lag structures.  These results indicate that the HLM models yield highly inflated Type I errors that support inaccurate directionality inferences.

\begin{center}

---------------

Insert Figure 3 Here

---------------

\end{center}

We now turn to results with varying lag structures across $x$ and $y$. That is, $z_{t}$ causes $y_{t}$ but the lag effect from $z$ to $x$ varies (and then the reverse is evaluated). The top panel of Figure 4 shows the percentage of significant coefficients across the replicates for both models when the lag effect of $z$ on $x$ varies. For the model that includes $y_{t-1}$ as a covariate, the proportion of significant estimates remain at the nominal level except for the concurrent and lag-five structures (12.4% and 6.6% respectively). This behavior is the same for the model that does not include the covariate, where the proportion of significance tests are 13.2% and 6.0% for the concurrent and lag-five structures, respectively. 

The bottom panel of Figure 4 demonstrates results when the lag effect of $z$ on $y$ varies. The proportion of significance tests are above the nominal level under the concurrent, lag-one, and lag-five structures (13%, 6.4%, and 5.6%, respectively) for the model that includes $y_{t-1}$ as a covariate and the same patterns emerge for the model that does not include the covariate (13.6%, 6.6%, and 6.4%, respectively).

In this simulation, the data generating process is again incoherent with our beliefs about the nature of the effects. Other variables, rather than a direction effect between $x$ and $y$, are driving significant beta weights. When the lag effect of $z$ on $x$ is the same as the lag effect of $z$ on $y$ both models produce significant results above the nominal rejection level. Although the problematic rejection rates are reduced when the lag structures vary, Type I error rates still exceed the nominal value in many instances.

\begin{center}

---------------

Insert Figure 4 Here

---------------

\end{center}
 


## Summary of Results

In our simulation worlds the direction of effects changed across worlds while the lag structure of effects changed within worlds. Modeling efforts could then be deficient through several means. They could miss the lag structure despite having the directional effect correct, miss the directional effect despite having the lag structure correct, or miss both. These deficiencies reveal the challenges of modeling processes over time. 

Two models were applied to the different worlds. The first included $y_{t-1}$ as a covariate and mirrored what is used in current event sampling studies, while the second did not include this term to contrast the results. Both models were unable to discriminate between the various worlds and would therefore lead to incorrect directionality inferences if they were the only justification presented.

The first simulation world (i.e., $x$ causes $y$) demonstrated that we can miss the effect even when the assumed direction is correct. The models appropriately captured the effect when $x$ immediately caused $y$, but failed to do so when the true process occurred at longer lags. In the second simulation world (i.e., $y$ causes $x$), the proportion of significant coefficients in both models was far above the nominal rate across a variety of lags. Partialling a prior observation of the outcome variable, therefore, does little to keep the model impartial after misspecifying the direction of effects. Bias was immense in the third simulation world (i.e., common cause). Although the proportion of significant results reduced when the lag effects from $z$ differed across $x$ and $y$, they still exceeded the nominal level under many lag structures. 

```{r Figure1, fig.cap="Proportion of significant results across the two statistical models applied to data where X causes Y."}
library(ggplot2)

Lag_Time = c(0:5)
Sims1_Wcontrol_Results = c(1.0,0.054,0.056,0.058,0.062,0.052)
Sims1_WOcontrol_Results = c(1.0,0.08,0.058,0.064,0.06,0.054)



df_Sims1 = data.frame("Lag_Time" = Lag_Time,
                      "P_Significant_Wcontrol" = Sims1_Wcontrol_Results,
                      "P_Significant_WOcontrol" = Sims1_WOcontrol_Results)


plot(Sims1_Wcontrol_Results~Lag_Time, type = "b", xlab = "Time Lag", ylab = "Proportion Significant", main = "Data Generating World: X causes Y")
lines(Sims1_WOcontrol_Results~Lag_Time, lty = 2, type = "b", pch = 8)
legend(3,0.60, legend = c("With Yt-1 Covariate", "Without Yt-1 Covariate"), lty = c(1,2), pch = c(1,8), cex = 0.90, title = "Model Applied")
abline(h = 0.05)
```


```{r Figure2, fig.cap="Proportion of significant results across the two statistical models applied to data where Y causes X."}
Lag_Time = c(0:5)
Sims2_Wcontrol_Results = c(1.0,.098,0.042,0.072,0.062, 0.06)
Sims2_WOcontrol_Results = c(1.0,.074,0.04,0.068,0.07, 0.06)



df_Sims2 = data.frame("Lag_Time" = Lag_Time,
                      "P_Significant_Wcontrol" = Sims2_Wcontrol_Results,
                      "P_Significant_WOcontrol" = Sims2_WOcontrol_Results)


plot(Sims2_Wcontrol_Results~Lag_Time, type = "b", xlab = "Time Lag", ylab = "Proportion Significant", main = "Data Generating World: Y causes X")
lines(Sims2_WOcontrol_Results~Lag_Time, lty = 2, type = "b", pch = 8)
legend(3,0.60, legend = c("With Yt-1 Covariate", "Without Yt-1 Covariate"), lty = c(1,2), pch = c(1,8), cex = 0.90, title = "Model Applied")
abline(h = 0.05)
```


```{r Figure3, fig.cap="Proportion of significant results across the two statistical models applied to data where Z causes both X and Y with a symmetric lag structure."}
Lag_Time = c(0:5)
Sims3_Wcontrol_Results = c(0.13,0.128,0.096,0.11,0.12,0.124)
Sims3_WOcontrol_Results = c(0.136,0.126,0.094,0.114,0.114,0.124)



df_Sims3 = data.frame("Lag_Time" = Lag_Time,
                      "P_Significant_Wcontrol" = Sims3_Wcontrol_Results,
                      "P_Significant_WOcontrol" = Sims3_WOcontrol_Results)


plot(Sims3_Wcontrol_Results~Lag_Time, type = "b", xlab = "Time Lag", ylab = "Proportion Significant", main = "Data Generating World: Z causes X and Y \nEquivalent Lag Effects", ylim = c(0,0.50))
lines(Sims3_WOcontrol_Results~Lag_Time, lty = 2, type = "b", pch = 8)
legend(3,0.40, legend = c("With Yt-1 Covariate", "Without Yt-1 Covariate"), lty = c(1,2), pch = c(1,8), cex = 0.90, title = "Model Applied")
abline(h = 0.05)
```



```{r Figure4, fig.height = 9, fig.cap="Proportion of significant results across the two statistical models applied to data where Z causes both X and Y but the lag from Z to X varies in the top panel and the lag from Z to Y varies in the bottom panel."}

Lag_Time = c(0:5)
Sims4_Wcontrol_Results = c(0.13,0.04,0.062,0.034,0.04,0.062)
Sims4_WOcontrol_Results = c(0.136,0.042,0.06,0.034,0.04,0.062)



df_Sims4 = data.frame("Lag_Time" = Lag_Time,
                      "P_Significant_Wcontrol" = Sims4_Wcontrol_Results,
                      "P_Significant_WOcontrol" = Sims4_WOcontrol_Results)

Lag_Time = c(0:5)
Sims5_Wcontrol_Results = c(0.13,0.064,0.048,0.042,0.048,0.056)
Sims5_WOcontrol_Results = c(0.136,0.066,0.044,0.046,0.048,0.064)



df_Sims5 = data.frame("Lag_Time" = Lag_Time,
                      "P_Significant_Wcontrol" = Sims5_Wcontrol_Results,
                      "P_Significant_WOcontrol" = Sims5_WOcontrol_Results)

par(mfrow = c(2,1))



plot(Sims4_Wcontrol_Results~Lag_Time, type = "b", xlab = "Time Lag", ylab = "Percent Significant", main = "Data Generating World: Z causes X and Y \nVarying Lag Effects on X", ylim = c(0,0.50))
lines(Sims4_WOcontrol_Results~Lag_Time, lty = 2, type = "b", pch = 8)
legend(3,0.40, legend = c("With Yt-1 Covariate", "Without Yt-1 Covariate"), lty = c(1,2), pch = c(1,8), cex = 0.90, title = "Model Applied")
abline(h = 0.05)


plot(Sims5_Wcontrol_Results~Lag_Time, type = "b", xlab = "Time Lag", ylab = "Percent Significant", main = "Data Generating World: Z causes X and Y \nVarying Lag Effects on Y", ylim = c(0,0.5))
lines(Sims5_WOcontrol_Results~Lag_Time, lty = 2, type = "b", pch = 8)
legend(3,0.40, legend = c("With Yt-1 Covariate", "Without Yt-1 Covariate"), lty = c(1,2), pch = c(1,8), cex = 0.90, title = "Model Applied")
abline(h = 0.05)

```
